<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Appointments - Mini Hospital Appointment System</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar">
      <div class="nav-container">
        <div class="nav-logo">
          <h2>üè• Mini Hospital</h2>
        </div>
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="home.html" class="nav-link">Home</a>
          </li>
          <li class="nav-item">
            <a href="doctors.html" class="nav-link">Doctors</a>
          </li>
          <li class="nav-item">
            <a href="patients.html" class="nav-link">Patients</a>
          </li>
          <li class="nav-item">
            <a href="appointments.html" class="nav-link active">Appointments</a>
          </li>
          <li class="nav-item">
            <a href="index.html" class="nav-link logout">Logout</a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <div class="container">
        <div class="page-header">
          <h1>Appointment Management</h1>
          <p>Schedule and manage patient appointments</p>
        </div>

        <!-- Book Appointment Form -->
        <div class="form-section">
          <h2>Book New Appointment</h2>
          <form id="appointmentForm" class="appointment-form">
            <div class="form-row">
              <div class="form-group">
                <label for="appointmentPatient">Select Patient:</label>
                <select
                  id="appointmentPatient"
                  name="appointmentPatient"
                  required
                >
                  <option value="">Choose a patient...</option>
                  <!-- Options will be populated from localStorage -->
                </select>
              </div>
              <div class="form-group">
                <label for="appointmentDoctor">Select Doctor:</label>
                <select
                  id="appointmentDoctor"
                  name="appointmentDoctor"
                  required
                >
                  <option value="">Choose a doctor...</option>
                  <!-- Options will be populated from localStorage -->
                </select>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="appointmentDate">Date:</label>
                <input
                  type="date"
                  id="appointmentDate"
                  name="appointmentDate"
                  required
                />
              </div>
              <div class="form-group">
                <label for="appointmentTime">Time:</label>
                <select id="appointmentTime" name="appointmentTime" required>
                  <option value="">Choose time...</option>
                  <option value="09:00">9:00 AM</option>
                  <option value="10:00">10:00 AM</option>
                  <option value="11:00">11:00 AM</option>
                  <option value="12:00">12:00 PM</option>
                  <option value="14:00">2:00 PM</option>
                  <option value="15:00">3:00 PM</option>
                  <option value="16:00">4:00 PM</option>
                  <option value="17:00">5:00 PM</option>
                </select>
              </div>
            </div>
            <div class="form-group">
              <label for="appointmentNotes">Notes (Optional):</label>
              <textarea
                id="appointmentNotes"
                name="appointmentNotes"
                rows="3"
                placeholder="Any additional notes about the appointment..."
              ></textarea>
            </div>
            <button type="submit" class="submit-btn">Book Appointment</button>
          </form>
        </div>

        <!-- Appointments List -->
        <div class="appointments-section">
          <div class="section-header">
            <h2>Scheduled Appointments</h2>
            <button id="clearAppointmentsBtn" class="clear-btn">
              Clear All Appointments
            </button>
          </div>

          <div id="appointmentsList" class="appointments-list">
            <!-- Appointments will be dynamically loaded here -->
          </div>

          <div
            id="noAppointmentsMessage"
            class="no-data-message"
            style="display: none"
          >
            <p>
              No appointments scheduled yet. Book a new appointment using the
              form above.
            </p>
          </div>
        </div>
      </div>
    </main>

    <script>
      // Appointment management functionality
      document.addEventListener("DOMContentLoaded", function () {
        loadPatients(); // Load patients for dropdown
        loadDoctors(); // Load doctors for dropdown
        loadAppointments(); // Load existing appointments
        setMinDate(); // Set minimum date to today
      });

      // Handle form submission
      document
        .getElementById("appointmentForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          bookAppointment();
        });

      // Handle clear all appointments button
      document
        .getElementById("clearAppointmentsBtn")
        .addEventListener("click", function () {
          if (
            confirm(
              "Are you sure you want to clear all appointments? This action cannot be undone."
            )
          ) {
            clearAllAppointments();
          }
        });

      // Function to load patients into dropdown
      function loadPatients() {
        const patients = JSON.parse(localStorage.getItem("patients")) || [];
        const patientSelect = document.getElementById("appointmentPatient");

        // Clear existing options except the first one
        patientSelect.innerHTML =
          '<option value="">Choose a patient...</option>';

        // Add patient options
        patients.forEach((patient) => {
          const option = document.createElement("option");
          option.value = `${patient.name} (Age: ${patient.age})`;
          option.textContent = `${patient.name} (Age: ${patient.age})`;
          patientSelect.appendChild(option);
        });
      }

      // Function to load doctors into dropdown
      function loadDoctors() {
        const doctors = JSON.parse(localStorage.getItem("doctors")) || [];
        const doctorSelect = document.getElementById("appointmentDoctor");

        // Clear existing options except the first one
        doctorSelect.innerHTML = '<option value="">Choose a doctor...</option>';

        // Add doctor options
        doctors.forEach((doctor) => {
          const option = document.createElement("option");
          option.value = `${doctor.name} - ${doctor.specialty}`;
          option.textContent = `${doctor.name} - ${doctor.specialty}`;
          doctorSelect.appendChild(option);
        });
      }

      // Function to set minimum date to today
      function setMinDate() {
        const today = new Date().toISOString().split("T")[0];
        document.getElementById("appointmentDate").setAttribute("min", today);
      }

      // Function to book a new appointment
      function bookAppointment() {
        // Get form data
        const patient = document.getElementById("appointmentPatient").value;
        const doctor = document.getElementById("appointmentDoctor").value;
        const date = document.getElementById("appointmentDate").value;
        const time = document.getElementById("appointmentTime").value;
        const notes = document.getElementById("appointmentNotes").value;

        // Create appointment object
        const appointment = {
          id: Date.now(), // Simple ID generation using timestamp
          patient: patient,
          doctor: doctor,
          date: date,
          time: time,
          notes: notes,
          dateBooked: new Date().toLocaleDateString(),
        };

        // Get existing appointments from localStorage
        let appointments =
          JSON.parse(localStorage.getItem("appointments")) || [];

        // Add new appointment
        appointments.push(appointment);

        // Save back to localStorage
        localStorage.setItem("appointments", JSON.stringify(appointments));

        // Clear form
        document.getElementById("appointmentForm").reset();

        // Reload appointments list
        loadAppointments();

        // Show success message
        alert("Appointment booked successfully!");
      }

      // Function to load and display appointments
      function loadAppointments() {
        const appointments =
          JSON.parse(localStorage.getItem("appointments")) || [];
        const appointmentsList = document.getElementById("appointmentsList");
        const noAppointmentsMessage = document.getElementById(
          "noAppointmentsMessage"
        );

        if (appointments.length === 0) {
          appointmentsList.innerHTML = "";
          noAppointmentsMessage.style.display = "block";
        } else {
          noAppointmentsMessage.style.display = "none";
          appointmentsList.innerHTML = appointments
            .map(
              (appointment) => `
                    <div class="appointment-card">
                        <div class="appointment-info">
                            <h3>${appointment.patient}</h3>
                            <p><strong>Doctor:</strong> ${
                              appointment.doctor
                            }</p>
                            <p><strong>Date:</strong> ${appointment.date}</p>
                            <p><strong>Time:</strong> ${appointment.time}</p>
                            ${
                              appointment.notes
                                ? `<p><strong>Notes:</strong> ${appointment.notes}</p>`
                                : ""
                            }
                            <p><strong>Booked:</strong> ${
                              appointment.dateBooked
                            }</p>
                        </div>
                        <div class="appointment-actions">
                            <button onclick="deleteAppointment(${
                              appointment.id
                            })" class="delete-btn">Cancel</button>
                        </div>
                    </div>
                `
            )
            .join("");
        }
      }

      // Function to delete a specific appointment
      function deleteAppointment(appointmentId) {
        if (confirm("Are you sure you want to cancel this appointment?")) {
          let appointments =
            JSON.parse(localStorage.getItem("appointments")) || [];
          appointments = appointments.filter(
            (appointment) => appointment.id !== appointmentId
          );
          localStorage.setItem("appointments", JSON.stringify(appointments));
          loadAppointments(); // Reload the list
        }
      }

      // Function to clear all appointments
      function clearAllAppointments() {
        localStorage.removeItem("appointments");
        loadAppointments(); // Reload the list
        alert("All appointments have been cleared.");
      }
    </script>
  </body>
</html>
