<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Patients - Mini Hospital Appointment System</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar">
      <div class="nav-container">
        <div class="nav-logo">
          <h2>üè• Mini Hospital</h2>
        </div>
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="home.html" class="nav-link">Home</a>
          </li>
          <li class="nav-item">
            <a href="doctors.html" class="nav-link">Doctors</a>
          </li>
          <li class="nav-item">
            <a href="patients.html" class="nav-link active">Patients</a>
          </li>
          <li class="nav-item">
            <a href="appointments.html" class="nav-link">Appointments</a>
          </li>
          <li class="nav-item">
            <a href="index.html" class="nav-link logout">Logout</a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
      <div class="container">
        <div class="page-header">
          <h1>Patient Management</h1>
          <p>Add new patients and manage existing patient records</p>
        </div>

        <!-- Add Patient Form -->
        <div class="form-section">
          <h2>Add New Patient</h2>
          <form id="patientForm" class="patient-form">
            <div class="form-row">
              <div class="form-group">
                <label for="patientName">Full Name:</label>
                <input
                  type="text"
                  id="patientName"
                  name="patientName"
                  required
                />
              </div>
              <div class="form-group">
                <label for="patientAge">Age:</label>
                <input
                  type="number"
                  id="patientAge"
                  name="patientAge"
                  min="0"
                  max="120"
                  required
                />
              </div>
            </div>
            <div class="form-group">
              <label for="patientPhone">Phone Number:</label>
              <input
                type="tel"
                id="patientPhone"
                name="patientPhone"
                required
              />
            </div>
            <button type="submit" class="submit-btn">Add Patient</button>
          </form>
        </div>

        <!-- Patients List -->
        <div class="patients-section">
          <div class="section-header">
            <h2>Registered Patients</h2>
            <button id="clearPatientsBtn" class="clear-btn">
              Clear All Patients
            </button>
          </div>

          <div id="patientsList" class="patients-list">
            <!-- Patients will be dynamically loaded here -->
          </div>

          <div
            id="noPatientsMessage"
            class="no-data-message"
            style="display: none"
          >
            <p>
              No patients registered yet. Add a new patient using the form
              above.
            </p>
          </div>
        </div>
      </div>
    </main>

    <script>
      // Patient management functionality
      document.addEventListener("DOMContentLoaded", function () {
        loadPatients(); // Load existing patients on page load
      });

      // Handle form submission
      document
        .getElementById("patientForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          addPatient();
        });

      // Handle clear all patients button
      document
        .getElementById("clearPatientsBtn")
        .addEventListener("click", function () {
          if (
            confirm(
              "Are you sure you want to clear all patients? This action cannot be undone."
            )
          ) {
            clearAllPatients();
          }
        });

      // Function to add a new patient
      function addPatient() {
        // Get form data
        const name = document.getElementById("patientName").value;
        const age = document.getElementById("patientAge").value;
        const phone = document.getElementById("patientPhone").value;

        // Create patient object
        const patient = {
          id: Date.now(), // Simple ID generation using timestamp
          name: name,
          age: age,
          phone: phone,
          dateAdded: new Date().toLocaleDateString(),
        };

        // Get existing patients from localStorage
        let patients = JSON.parse(localStorage.getItem("patients")) || [];

        // Add new patient
        patients.push(patient);

        // Save back to localStorage
        localStorage.setItem("patients", JSON.stringify(patients));

        // Clear form
        document.getElementById("patientForm").reset();

        // Reload patients list
        loadPatients();

        // Show success message
        alert("Patient added successfully!");
      }

      // Function to load and display patients
      function loadPatients() {
        const patients = JSON.parse(localStorage.getItem("patients")) || [];
        const patientsList = document.getElementById("patientsList");
        const noPatientsMessage = document.getElementById("noPatientsMessage");

        if (patients.length === 0) {
          patientsList.innerHTML = "";
          noPatientsMessage.style.display = "block";
        } else {
          noPatientsMessage.style.display = "none";
          patientsList.innerHTML = patients
            .map(
              (patient) => `
                    <div class="patient-card">
                        <div class="patient-info">
                            <h3>${patient.name}</h3>
                            <p><strong>Age:</strong> ${patient.age}</p>
                            <p><strong>Phone:</strong> ${patient.phone}</p>
                            <p><strong>Added:</strong> ${patient.dateAdded}</p>
                        </div>
                        <div class="patient-actions">
                            <button onclick="deletePatient(${patient.id})" class="delete-btn">Delete</button>
                        </div>
                    </div>
                `
            )
            .join("");
        }
      }

      // Function to delete a specific patient
      function deletePatient(patientId) {
        if (confirm("Are you sure you want to delete this patient?")) {
          let patients = JSON.parse(localStorage.getItem("patients")) || [];
          patients = patients.filter((patient) => patient.id !== patientId);
          localStorage.setItem("patients", JSON.stringify(patients));
          loadPatients(); // Reload the list
        }
      }

      // Function to clear all patients
      function clearAllPatients() {
        localStorage.removeItem("patients");
        loadPatients(); // Reload the list
        alert("All patients have been cleared.");
      }
    </script>
  </body>
</html>
